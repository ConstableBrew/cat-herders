<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Cat Herding</title>
    <style>
    * {padding: 0; margin: 0; border: 0; background-color: #888;}
    </style>
<script>
setTimeout(function(){
    "use strict";

    let cvs = new Canvas();
    
    let radius   = 11;
    let scale  = (Math.min((width / radius), (height / radius)) / 1.5)|0;
    






    function render() {
        ctx.fillStyle = 'black';
        ctx.clearRect(0, 0, width, height);
        ctx.fillRect(0, 0, width, height);
        ctx.imageSmoothingEnabled = false;
        
        renderField();
        renderPiece();
        renderScore();
        renderGameOver();
    }

    function renderGameOver() {
        if (isPlaying) return;

        let left = ~~(width/2);
        let top = ~~(height/2);
        let fontSize = scale * 1.25;
        ctx.fillStyle = '#eee';
        ctx.font = fontSize + 'px sans-serif';
        ctx.fillText('GAME OVER', left - (2.7 * fontSize), top);
        ctx.fillText('Press any key', left - (2.8 * fontSize), top + (1.5 * fontSize));
    }

    function renderScore(){
        let fontSize = scale * 1.25;
        ctx.fillStyle = '#eee';
        ctx.font = fontSize + 'px sans-serif';
        ctx.fillText('TOP',   (0.55 * fontSize), (1 * fontSize));
        ctx.fillText('SCORE',  (0.55 * fontSize), (2 * fontSize));
        ctx.fillText('LINES',  (0.55 * fontSize), (3 * fontSize));
        ctx.fillText(topScore, (5 * fontSize), (1 * fontSize));
        ctx.fillText(score   , (5 * fontSize), (2 * fontSize));
        ctx.fillText(totalLines   , (5 * fontSize), (3 * fontSize));
    }

    function renderField(){
        let left = ~~((width - cols * scale)/2);
        let top = ~~((height - rows * scale)/2);

        ctx.fillStyle = '#ccc';
        ctx.fillRect(left - Math.max(0.1 * scale, 3), top, cols * scale + 2 * Math.max(0.1 * scale, 3), rows * scale + Math.max(0.1 * scale, 3));
        ctx.fillRect(left, top, cols * scale, rows * scale);

        field.forEach( (row, j) => {
            row.forEach( (col, i) => {
                ctx.fillStyle = colors[col];
                ctx.fillRect(left + i * scale, top + j * scale, scale, scale);
            });
        });
    }

    function renderPiece(){
        let left = ~~((width - cols * scale)/2);
        let top = ~~((height - rows * scale)/2);

        currentPiece.shape.forEach( (row, j) => {
            row.forEach( (col, i) => {
                if (col) {
                    ctx.fillStyle = colors[col];
                    ctx.fillRect(left + (position.x + i) * scale, top + (position.y + j) * scale, scale, scale);
                }
            });
        });
    }
    initialize();
},0);

</script>
</head>
<body></body>
</html>